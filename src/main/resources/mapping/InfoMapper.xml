<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.surfilter.dao.InfoMapper">
    <insert id="addInfo" parameterType="info" useGeneratedKeys="true">
        insert into info (
        url,
        is_conn,
        port,
        email,
        tel,
        creation_time,
        expire_time,
        company,
        last_update_time,
        file_name,
        ip,
        web_phone,
        qq,
        wx,
        address,
        title
        ) values (
        #{url},
        #{isConn},
        #{port},
        #{email},
        #{tel},
        #{creationTime},
        #{expireTime},
        #{company},
        #{lastUpdateTime},
        #{fileName},
        #{ip},
        #{webPhone},
        #{qq},
        #{wx},
        #{address},
        #{title}
        )
    </insert>

    <insert id="addListInfo" parameterType="java.util.List" useGeneratedKeys="true">
        insert into info (
        url,
        is_conn,
        port,
        email,
        tel,
        creation_time,
        expire_time,
        company,
        last_update_time,
        file_name,
        ip,
        web_phone,
        qq,
        wx,
        address,
        title,
        rule,
        rule_count,
        is_whois
        ) values
        <foreach collection="list" item="item" index="index" separator=",">
            (
            #{item.url},
            #{item.isConn},
            #{item.port},
            #{item.email},
            #{item.tel},
            #{item.creationTime},
            #{item.expireTime},
            #{item.company},
            #{item.lastUpdateTime},
            #{item.fileName},
            #{item.ip},
            #{item.webPhone},
            #{item.qq},
            #{item.wx},
            #{item.address},
            #{item.title},
            #{item.rule},
            #{item.ruleCount},
            #{item.isWhois}
            )
        </foreach>
    </insert>

    <select id="listRuleInfo" resultType="info">
        select url,id from info where rule is null limit 100;
    </select>
    <update id="updateRuleInfo" parameterType="java.util.List">
        <foreach collection="list" item="item" index="index" open="" close="" separator=";">
            update info
            <set>
                <if test="item.rule != null ">
                    rule = #{item.rule,jdbcType=VARCHAR},
                </if>
                <if test="item.ruleCount != null">
                    rule_count = #{item.ruleCount,jdbcType=INTEGER},
                </if>
            </set>
            where id = #{item.id,jdbcType=BIGINT}
        </foreach>
    </update>

    <select id="listInfo" resultType="info">
        select  id,url,is_conn,port,email,tel,creation_time,expire_time,ip,last_update_time,web_phone,qq,title,category from info
        <where>
          is_conn =1   and category = 1
        </where>
    </select>
</mapper>